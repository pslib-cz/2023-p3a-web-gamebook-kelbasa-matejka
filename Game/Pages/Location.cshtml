@page
@using Game.Services;
@model Game.Pages.Location
@{
    ViewData["Title"] = Model.lModel.Name;
}

<main style="background-image: url(Assets/LocationsBg/@Model.lModel.Background);">
    <div class="cont">
        <h1>@Model.lModel.Name</h1>
        <p>@Model.lModel.Description</p>    
    </div>
    

    @if (Model.lModel.Enemy != null)
    {
        @await Html.PartialAsync("Combat", Model)
    }
    @if (Model.lModel.PuzzleKey != null)
    {
        @await Html.PartialAsync("PuzzleForm", Model)
    }

    <div class="cont">
        <h2>Player: </h2>
        <p>Player has @Model.pModel.Hp HP</p>
        <p>Player deals @Model.pModel.Damage DMG</p>
        <p>Player energy: @Model.pModel.Energy</p>
        <p>Player is in location #@Model.pModel.CurrentLocationId</p>
        <p>Players inventory: </p>
        @if (Model.pModel.Items != null)
        {
            <ul>
                @foreach (var item in Model.pModel.Items)
                {
                    <li>@item.Name - @item.Description</li>
                }
            </ul>
        }
    </div>
    @foreach (var v in Model.lModel.Connections)
    {
        <div>
            <p>@v.Description <a asp-page="Location" asp-route-id="@v.ToLocationID">-></a>
                @if (v.Locked)
                {
                    <span style="color: red;">LOCKED</span>
                }
                @if (v.RequiredItem != null)
                {
                    if (Model.pModel.Items != null && Model.pModel.Items.Count(a => a.ID == v.RequiredItem.ID) > 0)
                    {
                        <span>@v.RequiredItem.Name is required (you have it)</span>
                    }
                    else
                    {
                        <span style="color: red;">@v.RequiredItem.Name is required</span>
                    }

                }
            </p>
        </div>
    }

    <div class="pick-ups">
        @foreach(var i in Model.lModel.Items)
        {
            @if (!Model.pModel.PickedUpItems.Contains(i.ID))
            {
                <div>
                    <p>@i.Name</p>
                    <form method="post">
                        <input hidden name="ItemID" value="@i.ID" />
                        <button type="submit" asp-page-handler="PickUpItem">Pick up</button>
                    </form>
                    
                </div>
            }
        }
    </div>
</main>
<script src="/_framework/aspnetcore-browser-refresh.js"></script>