@model Game.Pages.Location


@if (Model.lModel.Enemy != null)
{
    <div class="enemy">
        @if (!Model.pModel.CombatState.CleanedLocations.Contains(Model.lModel.LocationID))
        {
            <div class="enemy__hp">
                @{
                    int widthPercentage = (int)Math.Floor(Model.pModel.CombatState.CurrentEnemy.Hp / (Model.lModel.Enemy.Hp / 100.0));
                }
                <span>@Model.pModel.CombatState.CurrentEnemy.Hp</span>
                <div style="width: @widthPercentage%"></div>            
            </div>
            <img class="enemy__img" src="Assets/Enemy/@Model.lModel.Enemy.Img" alt="@Model.lModel.Enemy.Name">    
            <h2 class="enemy__txt">@Model.lModel.Enemy.Name</h2>                                                                                                 
        }
        else if(!Model.lModel.Items.Any())
        {
            <h2 class="enemy__txt">@Model.lModel.Enemy.Name byl poražen</h2>
        } 
    </div>
}
@if (!Model.pModel.CombatState.IsCombatActive)
{
    @if (Model.lModel.Items.Any() && !Model.lModel.Items.All(item => Model.pModel.PickedUpItems.Contains(item.ID)) && (Model.lModel.PuzzleKey == null || Model.pModel.SolvedPuzzleLocations.Contains(Model.lModel.LocationID)))
    {
        @foreach (var i in Model.lModel.Items)
        {
            @if (!Model.pModel.PickedUpItems.Contains(i.ID))
            {
                <div class="item">
                    <h2 class="item__name">@i.Name</h2>
                    <img class="item__img" src="Assets/ItemIcons/@i.Icon" alt="@i.Description">
                </div>
            }
        }
    }
    @if (Model.lModel.PuzzleKey != null && !Model.pModel.SolvedPuzzleLocations.Contains(Model.lModel.LocationID))
    {
        <form class="puzzle" method="post">
            <label for="answer">Ven s tím tajemstvím!</label>
            <input type="text" id="answer" name="Answer" required />
            <button asp-page-handler="GuessPuzzle" type="submit">Potvrdit</button>
        </form>
    }
    else
    {
        @if (Model.lModel.PuzzleKey != null)
        {
            <p class="puzzle-ans">Povedlo se ti zjistit tajemství.</p>  
        }
    }

    @if (Model.pModel.CurrentLocationId == Model.WINNING_LOCATION_ID)
    {
        <a class="btn" asp-page="Endgame">Nic horšího už mě snad nečeká, chce to oraz...</a>
    }
}



